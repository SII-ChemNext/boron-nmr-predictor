{% extends "base.html" %}

{% block content %}
<div class="page-container">
    <!-- 左侧：分子编辑器和输入 -->
    <section class="editor-panel">
        <h2 data-i18n="editor.title">分子结构编辑</h2>

        <!-- Ketcher 容器（使用 iframe 加载本地 Standalone） -->
        <div id="ketcher-wrapper" class="ketcher-editor">
            <iframe
                id="ketcher-iframe"
                src="/ketcher"
                style="width: 100%; height: 100%; border: none; border-radius: 4px; background: white;">
            </iframe>
        </div>

        <!-- 溶剂选择 -->
        <div class="form-group">
            <label for="solvent-select" data-i18n="editor.selectSolvent">选择溶剂：</label>
            <select id="solvent-select" class="form-control">
                {% for solvent_name in solvents.keys() %}
                <option value="{{ solvent_name }}">{{ solvent_name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- 操作按钮 -->
        <div class="button-group">
            <button id="predict-btn" class="btn btn-primary" data-i18n="editor.btnPredict">开始预测</button>
            <button id="clear-btn" class="btn btn-secondary" data-i18n="editor.btnClear">清空画布</button>
            <button id="example-btn" class="btn btn-secondary" data-i18n="editor.btnExample">加载示例</button>
        </div>
    </section>

    <!-- 右侧：结果展示 -->
    <section class="result-panel">
        <h2 data-i18n="result.title">预测结果</h2>

        <!-- 加载状态 -->
        <div id="loading-state" class="state-container hidden">
            <div class="spinner"></div>
            <p data-i18n="result.loading">正在预测中，请稍候...</p>
        </div>

        <!-- 结果区域 -->
        <div id="result-state" class="state-container hidden">
            <!-- 标准化 SMILES -->
            <div class="result-item">
                <h3 data-i18n="result.canonicalSmiles">标准 SMILES</h3>
                <div class="smiles-box">
                    <code id="canonical-smiles"></code>
                    <button id="copy-smiles-btn" class="btn-copy" data-i18n="result.buttons.copy" title="复制 SMILES">📋</button>
                </div>
            </div>

            <!-- 预测表格 -->
            <div class="result-item">
                <h3 data-i18n="result.predictions">硼原子化学位移预测</h3>
                <table class="prediction-table">
                    <thead>
                        <tr>
                            <th data-i18n="result.table.atomIndex">原子索引</th>
                            <th data-i18n="result.table.element">元素</th>
                            <th data-i18n="result.table.chemicalShift">预测化学位移 (ppm)</th>
                        </tr>
                    </thead>
                    <tbody id="prediction-tbody">
                    </tbody>
                </table>
            </div>

            <!-- 分子结构图 -->
            <div class="result-item">
                <h3 data-i18n="result.moleculeImage">分子结构图（硼原子高亮）</h3>
                <div class="image-container">
                    <img id="molecule-img" src="" data-i18n="result.moleculeStructureAlt" alt="分子结构图" class="molecule-image">
                </div>
            </div>

            <!-- 下载按钮 -->
            <div class="result-item">
                <h3 data-i18n="result.downloads">下载选项</h3>
                <div class="download-buttons">
                    <button id="download-csv-btn" class="btn btn-download" data-i18n-html="result.buttons.downloadCSV">
                        📊 下载 CSV
                    </button>
                    <button id="download-json-btn" class="btn btn-download" data-i18n-html="result.buttons.downloadJSON">
                        📋 下载 JSON
                    </button>
                    <button id="download-image-btn" class="btn btn-download" data-i18n-html="result.buttons.downloadImage">
                        🖼️ 下载图片
                    </button>
                </div>
            </div>
        </div>

        <!-- 错误区域 -->
        <div id="error-state" class="state-container hidden">
            <div class="error-box">
                <h3 data-i18n="result.error">⚠️ 出错了</h3>
                <p id="error-message"></p>
                <button id="close-error-btn" class="btn btn-secondary" data-i18n="result.closeError">关闭</button>
            </div>
        </div>

        <!-- 初始提示 -->
        <div id="empty-state" class="state-container">
            <div class="empty-message">
                <p data-i18n="result.empty">👈 在左侧绘制分子结构，然后点击"开始预测"</p>
            </div>
        </div>
    </section>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/ketcher-integration.js') }}"></script>
<script src="{{ url_for('static', filename='js/result-handler.js') }}"></script>
{% endblock %}
